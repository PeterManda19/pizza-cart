<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Pizza Cart</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1 class="h1">Perfect Pizza</h1>

    <div class="shopping-cart" x-data="cartComponent()">
        <h2>Shopping Cart</h2>
        <template x-if="cart.length === 0">
            <p>Your cart is empty.</p>
            <div>
                <div>
                    <h3 class="display">Small</h3>
                    <button @click="addToCart('Small Pizza', 47.90)" class="add-button" x-show="!pizzaAdded('Small Pizza')">+</button>
                    <button @click="removeFromCart('Small Pizza', 47.90)" class="remove-button" x-show="!pizzaAdded('Small Pizza')">-</button>
                    <span class="cost" x-text="getCartItemCost('Small Pizza', 47.90) || 'R0.00' "></span>
                </div>
                <div>
                    <h3 class="display">Medium</h3>
                    <button @click="addToCart('Medium Pizza', 79.90)" class="add-button" x-show="!pizzaAdded('Medium Pizza')">+</button>
                    <button @click="removeFromCart('Medium Pizza', 79.90)" class="remove-button" x-show="!pizzaAdded('Medium Pizza')">-</button>
                    <span class="cost" x-text="getCartItemCost('Medium Pizza', 79.90) || 'R0.00'"></span>
                </div>
                <div>
                    <h3 class="display">Large</h3>
                    <button @click="addToCart('Large Pizza', 114.90)" class="add-button" x-show="!pizzaAdded('Large Pizza')">+</button>
                    <button @click="removeFromCart('Large Pizza', 114.90)" class="remove-button" x-show="!pizzaAdded('Large Pizza')">-</button>
                    <span class="cost" x-text="getCartItemCost('Large Pizza', 114.90) || 'R0.00'"></span>
                </div>
            </div>
        </template>
    
        <template x-for="(pizza, index) in cart" :key="index">
            <div>
                <h3 class="display" x-text="pizza.name"></h3>
                <button @click="addToCart(pizza.name, pizza.price)" class="add-button" x-show="pizzaAdded(pizza.name) && pizza.quantity > 0">+</button>
                <button @click="removeFromCart(pizza.name, pizza.price)" class="remove-button" x-show="pizzaAdded(pizza.name)">-</button>
                <span class="cost" x-text="getCartItemCost(pizza.name, pizza.price)"></span>
            </div>
        </template>
        
        <h3 x-show="cart.length > 0" x-text="'Total cost: R' + calculateTotal()"></h3>
        <p x-text="message"></p>
        <div class="payment-amount" x-show="cart.length > 0">
            <label for="paymentAmount">Payment amount:</label>
            <input type="number" id="paymentAmount" x-model="paymentAmount" step="0.01">
        </div>
    
        <button class="button-size" @click="checkout()" x-show="cart.length > 0"><b>Pay</b></button>
    </div>
        

    <div class="pizzas">
        <div class="pizza small-pizza" >
            <img src="pizza1.png" alt="pizza-image" width="70">
            <h2>Small Pizza</h2>
            <h3>R47.90</h3>
            <p>
              small pizza with 3 toppings
              <br>
              1 meat topping.
              <br>
              3 or fewer other toppings
            </p>
            <button @click="buyPizza('Small Pizza', 47.90)" class="button-size" x-show="!pizzaAdded('Small Pizza')"><b>Buy</b></button>
            <span class="cost" x-text="getCartItemCost('Small Pizza', 47.90) || 'R0.00' "></span>
        </div>
          
        <div class="pizza medium-pizza">
            <img src="pizza2.png" alt="pizza-image" width="110">
            <h2>Medium Pizza</h2>
            <h3>R79.90</h3>
            <p>
              medium margeritha pizza with 3 toppings max.
              <br>
              2 or fewer meat toppings.
              <br>
              3 or fewer other toppings.
            </p>
            <button @click="buyPizza('Medium Pizza', 79.90)" class="button-size" x-show="!pizzaAdded('Medium Pizza')"><b>Buy</b></button>
            <span class="cost" x-text="getCartItemCost('Medium Pizza', 79.90) || 'R0.00'"></span>
        </div>
          
        <div class="pizza large-pizza">
            <img src="pizza4.png" alt="pizza-image" width="140">
            <h2>Large Pizza</h2>
            <h3>R114.90</h3>
            <p>
              large margeritha pizza with 3 toppings max.
              <br>
              3 meat toppings max.
              <br>
              3 or fewer other toppings
            </p>
            <button @click="buyPizza('Large Pizza', 114.90)" class="button-size" x-show="!pizzaAdded('Large Pizza')"><b>Buy</b></button>
            <span class="cost" x-text="getCartItemCost('Large Pizza', 114.90) || 'R0.00'"></span>
        </div>          
    </div>

    <div class="pizza contact-details">
        <div class="pizzas">
            <div class="box">
                <p>
                    <strong>
                        Contact us at : (021)-541-1000
                        <br>
                        twitter
                        <br>
                        /fb
                        <br>
                        /insta
                        <br>
                        @perfectpizza
                    </strong>        
                </p>
            </div>
    
            <div class="box">
                <p>
                    <strong>
                        Pizza Plaza
                        <br>
                        Dough Road
                        <br>
                        Base Town
                    </strong> 
                </p>
            </div>
        </div>
    </div>

    <script>
        /**
         * Alpine.js component for managing the shopping cart functionality
         */
        function cartComponent() {
            return {
                // Cart items
                cart: [],

                /**
                 * Add a pizza to the cart
                 * @param {string} name - The name of the pizza.
                 * @param {number} price - The price of the pizza.
                 */
                addToCart: function (name, price) {
                    // Check if the selected pizza is already in the cart
                    const existingPizza = this.cart.find(
                        item => item.name === name && item.price === price
                    );

                    if (existingPizza) {
                        existingPizza.quantity++;
                    } else {
                        this.cart.push({
                            name: name,
                            price: price,
                            quantity: 1,
                            amount: price
                        });
                    }
                },

                /**
                 * Buy a pizza and add it to the cart
                 * @param {string} name - The name of the pizza.
                 * @param {number} price - The price of the pizza.
                 */
                buyPizza: function (name, price) {
                    this.addToCart(name, price);
                    this.cartAdded = true;
                },

                /**
                 * Check if a pizza is already added to the cart
                 * @param {string} name - The name of the pizza.
                 * @returns {boolean} - True if the pizza is added, false otherwise.
                 */
                pizzaAdded: function (name) {
                    return this.cart.some(item => item.name === name);
                },

                /**
                 * Remove a pizza from the cart
                 * @param {string} name - The name of the pizza.
                 * @param {number} price - The price of the pizza.
                 */
                 removeFromCart: function (name, price) {
                    const index = this.cart.findIndex(item => item.name === name && item.price === price);
                    if (index !== -1) {
                        const pizza = this.cart[index];
                        if (pizza.quantity > 1) {
                            pizza.quantity--;
                            pizza.amount = pizza.price * pizza.quantity;
                        } else {
                            this.cart.splice(index, 1);
                        }
                    }
                },

                /**
                 * Calculate the total cost of the items in the cart
                 * @returns {string} - The total cost in the format '0.00'
                 */
                calculateTotal: function () {
                    if (this.cart.length === 0) {
                        return '0.00';
                    }

                    let total = 0;
                    for (let i = 0; i < this.cart.length; i++) {
                        const pizza = this.cart[i];
                        total += pizza.price * pizza.quantity;
                    }
                    return total.toFixed(2);
                },

                // Message to be displayed
                message: "Thank you for choosing Perfect Pizza!",

               /**
                 * Checkout function
                 */
                 checkout: function () {
                    if (this.cart.length === 0) return;

                    const paymentAmount = parseFloat(this.paymentAmount);
                    const totalCost = parseFloat(this.calculateTotal());

                    console.log("Total Cost:", totalCost);
                    console.log("Payment Amount:", paymentAmount);

                    if (!isNaN(paymentAmount) && paymentAmount >= totalCost) {
                        this.message = "Payment successful! Enjoy your pizzas!";
                        this.cart = [];
                    } else {
                        this.message = "Sorry, the payment amount is not sufficient.";
                    }
                },


                /**
                 * Get the cost of a specific pizza item in the cart
                 * @param {string} name - The name of the pizza.
                 * @param {number} price - The price of the pizza.
                 * @returns {string} - The cost of the pizza item in the format '0.00'
                 */
                getCartItemCost: function (name, price) {
                    const pizza = this.cart.find(item => item.name === name && item.price === price);
                    if (pizza) {
                        return (pizza.price * pizza.quantity).toFixed(2);
                    }
                    return '0.00';
                },
            };
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.js"></script>
</body>
</html>